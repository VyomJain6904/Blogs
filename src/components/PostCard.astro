---
import { IdToSlug } from "../utils/hash";
import { Icon } from "astro-icon/components";
import PostCardInfoIcon from "./widgets/PostCardInfoIcon.astro";
import { GetCoverURLForUnspecifiedEntry } from "../utils/cover";
import { locallang } from "../locales/translation";
import Keys from "../locales/keys";
import WriteupsConfig from "../../geeklurk";
import { formatDate } from "../utils/date";

export interface Props {
    id: string;
    title: string;
    published: Date;
    category?: string;
    tags?: string[];
    description?: string;
    image?: string;
    platform?: string;
    platformAvatar?: string;
    difficulty?: string;
    readingMetadata: { time: number; wordCount: number };
}

const props = Astro.props;
const entryID = IdToSlug(props.id);
const contentUrl = `/posts/${entryID}`;
const { time, wordCount } = props.readingMetadata;
---

<div class="post-card-container">
    <div class="post-card-inner">
        <!-- Cover Image -->
        <a href={contentUrl} class="cover-section">
            <img
                class="lozad cover-image"
                data-src={props.image ??
                    GetCoverURLForUnspecifiedEntry(entryID)}
                alt="PostCover"
            />
            <div class="cover-overlay">
                <Icon
                    name="cuida:caret-right-outline"
                    size={48}
                    class="overlay-icon"
                />
            </div>
        </a>

        <!-- Content Section -->
        <div class="content-section">
            <!-- Header with Platform Avatar -->
            <div class="card-header">
                {
                    props.category && (
                        <span class="meta-item">
                            <Icon name="mdi:tag-outline" size={16} />
                            {props.category}
                        </span>
                    )
                }
            </div>

            <!-- Reading Time -->
            <div class="reading-time">
                <span>{wordCount} {locallang(Keys.post_card_words)}</span>
                <span>â€¢</span>
                <span>{time} {locallang(Keys.post_card_minutes)}</span>
            </div>
        </div>
    </div>
</div>

<style>
    .post-card-container {
        @apply h-full;
    }

    .post-card-inner {
        @apply flex flex-col h-full rounded-2xl bg-[var(--card-color)] overflow-hidden transition-all hover:shadow-lg hover:scale-105;
    }

    .cover-section {
        position: relative;
        width: 100%;
        height: 160px;
        overflow: hidden;
    }

    .cover-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .cover-section:hover .cover-image {
        transform: scale(1.1);
    }

    .cover-overlay {
        position: absolute;
        inset: 0;
        background-color: rgba(0, 0, 0, 0);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.3s ease;
    }

    .cover-section:hover .cover-overlay {
        background-color: rgba(0, 0, 0, 0.4);
    }

    .overlay-icon {
        color: white;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .cover-section:hover .overlay-icon {
        opacity: 1;
    }

    .content-section {
        @apply flex-1 p-4 flex flex-col justify-between space-y-3;
    }

    .card-header {
        @apply flex items-start gap-3;
    }

    .platform-avatar {
        @apply w-12 h-12 rounded-lg object-cover border-2 border-[var(--primary-color-lighten)] flex-shrink-0;
    }

    .header-info {
        @apply flex-1 flex flex-col gap-2;
    }

    .card-title {
        @apply text-lg font-bold text-[var(--text-color)] hover:text-[var(--primary-color)] transition-colors line-clamp-2;
        font-family: var(--primary-font);
    }

    .difficulty-badge {
        @apply inline-flex w-fit px-2 py-1 rounded text-xs font-bold text-white;
        font-family: var(--primary-font);
    }

    .difficulty-easy {
        @apply bg-green-500/70;
    }

    .difficulty-medium {
        @apply bg-yellow-500/70;
    }

    .difficulty-hard {
        @apply bg-orange-500/70;
    }

    .difficulty-insane {
        @apply bg-red-500/70;
    }

    .card-description {
        @apply text-sm text-[var(--text-color-lighten)] line-clamp-2;
        font-family: var(--primary-font);
    }

    .card-metadata {
        @apply flex flex-wrap gap-3 text-xs text-[var(--text-color-lighten)];
        font-family: var(--primary-font);
    }

    .meta-item {
        @apply flex items-center gap-1;
    }

    .reading-time {
        @apply text-xs text-[var(--text-color-lighten)] flex gap-2;
        font-family: var(--primary-font);
    }
</style>
